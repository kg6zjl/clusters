apiVersion: v1
kind: ConfigMap
metadata:
  name: caddy-config
  namespace: caddy
data:
  Caddyfile: |
    (tls-wildcard) {
        tls /etc/caddy/certs/tls.crt /etc/caddy/certs/tls.key
    }

    # TLS for LOCAL DEVICES
    unifi.stevearnett.com {
        import tls-wildcard
        reverse_proxy https://192.168.1.1 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    nas.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://192.168.1.176:9999 {
            header_up Host 192.168.1.176:9999
        }
    }

    zb.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://192.168.1.36
    }

    # KUBE SERVICES
    auth.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://oauth2-proxy.auth.svc.cluster.local:4180
    }

    dashboard.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://kubernetes-dashboard.kube-system.svc.cluster.local
    }

    grafana.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://kube-prometheus-stack-grafana.monitoring.svc.cluster.local
    }

    prometheus.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090
    }

    ha.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://home-assistant.home-assistant.svc.cluster.local:8123
    }

    plex.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://plex-plex-media-server.plex.svc.cluster.local:32400
    }

    qb.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://gluetun.vpn.svc.cluster.local:8080
    }

    prowlarr.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://prowlarr.media.svc.cluster.local:9696
    }

    radarr.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://radarr.media.svc.cluster.local:7878
    }

    sonarr.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://sonarr.media.svc.cluster.local:8989
    }

    speedtest.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://speedtest-tracker.speedtest.svc.cluster.local:80 {
            header_up X-Forwarded-Proto https
        }
    }

    readarr.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://readarr.media.svc.cluster.local:8787
    }

    overseerr.kube.stevearnett.com {
        import tls-wildcard
        reverse_proxy http://overseerr.media.svc.cluster.local:5055
    }

    kube.stevearnett.com {
        import tls-wildcard
    }
